#!/usr/bin/bash

# install asdf version manager

# running as root user

umask 022
git clone --quiet https://github.com/asdf-vm/asdf.git /opt/asdf --branch v0.8.0
export ASDF_DATA_DIR=/opt/asdf
. /opt/asdf/asdf.sh
asdf plugin-add nodejs https://github.com/asdf-vm/asdf-nodejs.git
asdf plugin-add ruby https://github.com/asdf-vm/asdf-ruby.git
bash /opt/asdf/plugins/nodejs/bin/import-release-team-keyring
export RUBY_CONFIGURE_OPTS=--disable-install-doc
echo "gem: --no-document" > ~/.gemrc

# source me in provisioned_env.d
echo "export ASDF_DATA_DIR=/opt/asdf" > /tmp/asdf1337
echo ". /opt/asdf/asdf.sh" >> /tmp/asdf1337

install -m 755 -o ubuntu -g ubuntu /tmp/asdf1337 /home/ubuntu/provisioned_env.d/asdf
rm /tmp/asdf1337


cd ~ubuntu/contra
sg ubuntu "bash -c 'umask 002 && . /home/ubuntu/provisioned_env.sh && asdf install'"
chmod -R g+w /opt/asdf/installs/ruby/ /opt/asdf/shims



